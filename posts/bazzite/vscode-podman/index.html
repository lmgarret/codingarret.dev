<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>VSCode in Podman dev container | CodinGarret.dev</title>
<meta name=keywords content><meta name=description content="A guide on using VSCode in a Podman dev container (toolbox)
"><meta name=author content="LM. Garret"><link rel=canonical href=https://codingarret.dev/posts/bazzite/vscode-podman/><link crossorigin=anonymous href=/assets/css/stylesheet.8727c1aa07dda8f1d6401868fcbb89e468d62c75146a1ebdb086250ec564a05f.css integrity="sha256-hyfBqgfdqPHWQBho/LuJ5GjWLHUUah69sIYlDsVkoF8=" rel="preload stylesheet" as=style><link rel=icon href=https://codingarret.dev/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://codingarret.dev/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://codingarret.dev/favicon-32x32.png><link rel=apple-touch-icon href=https://codingarret.dev/apple-touch-icon.png><link rel=mask-icon href=https://codingarret.dev/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://codingarret.dev/posts/bazzite/vscode-podman/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="VSCode in Podman dev container"><meta property="og:description" content="A guide on using VSCode in a Podman dev container (toolbox)
"><meta property="og:type" content="article"><meta property="og:url" content="https://codingarret.dev/posts/bazzite/vscode-podman/"><meta property="og:image" content="https://codingarret.dev/images/posts/vscode-podman/cover.jpg"><meta property="article:section" content="posts"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://codingarret.dev/images/posts/vscode-podman/cover.jpg"><meta name=twitter:title content="VSCode in Podman dev container"><meta name=twitter:description content="A guide on using VSCode in a Podman dev container (toolbox)
"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://codingarret.dev/posts/"},{"@type":"ListItem","position":2,"name":"VSCode in Podman dev container","item":"https://codingarret.dev/posts/bazzite/vscode-podman/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"VSCode in Podman dev container","name":"VSCode in Podman dev container","description":"A guide on using VSCode in a Podman dev container (toolbox)\n","keywords":[],"articleBody":"I wrote this guide since I installed a Fedora immutable desktop spin (Bazzite) on my desktop and decided to set it up for development as well. Since toolbox and Podman are already installed out of the box, I thought it would be interesting to go all the way in and develop using VSCode attached to a Podman dev container created by toolbox. This unfortunately does not work perfectly out of the box, and I intend to keep this guide up-to-date with all the changes I had to perform in order to get my dev environment up and running!\nUsing Podman instead of Docker First, to make sure we can use Podman in place of Docker for dev containers, we need to adjust our VSCode settings as mentioned in the documentation, to point to our Podman installation. In you VSCode settings file, add the following entries:\n\"dev.containers.dockerPath\": \"podman\", \"dev.containers.dockerSocketPath\": \"/run/user/1000/podman/podman.sock\" Attaching VSCode to a running Podman container as a non-root user There are multiple reasons why you wouldn’t want to use the root user in your dev container:\nyou have multiple shell configs for your non-root host user you would like to use in the container (e.g. getting the same experience as toolbox enter my-container) you want to reuse your git config and credentials and do not want to have a distinct config per container it feels wrong to use root! It’s so often described as being a bad practice (which it is!), that even in a container we shouldn’t have to default to using the root user Now if you decide that you don’t mind, then good for you! You can skip this guide’s section :)\n1. Container-specific config If not already done, create your dev container with toolbox/any other tool of your liking. We will be referring to the container’s name as the env variable $TOOLBOX_CONTAINER_NAME in the rest of this guide .\nWe will now need to create a specific configuration file for the container, to tell VSCode to attach to it as a different user, but also pass other environment variables from the host. For this file, I largely copied content from this helpful GitHub issue’s comment, but don’t hesitate to adapt it to your needs.\nNote: I chose to attach as my host’s non-root user, hence passing the $USER env var. This comes with the added benefit of keeping my .zshrc and .oh-my-zsh configuration working out of the box and not having to create a different user in the container image and mount these files there. But please note that the user you will be using in the container has the same $HOME directory and that changes in the container could reflect in your host user’s home ⚠️.\nSo open up the file\nvim \"$HOME/.config/Code/User/globalStorage/ms-vscode-remote.remote-containers/nameConfigs/${TOOLBOX_CONTAINER_NAME}.json\"And write this content in it:\n{ \"remoteUser\": \"${localEnv:USER}\", \"remoteEnv\": { \"COLORTERM\": \"${localEnv:COLORTERM}\", \"DBUS_SESSION_BUS_ADDRESS\": \"${localEnv:DBUS_SESSION_BUS_ADDRESS}\", \"DESKTOP_SESSION\": \"${localEnv:DESKTOP_SESSION}\", \"DISPLAY\": \"${localEnv:DISPLAY}\", \"LANG\": \"${localEnv:LANG}\", \"SHELL\": \"${localEnv:SHELL}\", \"SSH_AUTH_SOCK\": \"${localEnv:SSH_AUTH_SOCK}\", \"TERM\": \"${localEnv:TERM}\", \"VTE_VERSION\": \"${localEnv:VTE_VERSION}\", \"XDG_CURRENT_DESKTOP\": \"${localEnv:XDG_CURRENT_DESKTOP}\", \"XDG_DATA_DIRS\": \"${localEnv:XDG_DATA_DIRS}\", \"XDG_MENU_PREFIX\": \"${localEnv:XDG_MENU_PREFIX}\", \"XDG_RUNTIME_DIR\": \"${localEnv:XDG_RUNTIME_DIR}\", \"XDG_SESSION_DESKTOP\": \"${localEnv:XDG_SESSION_DESKTOP}\", \"XDG_SESSION_TYPE\": \"${localEnv:XDG_SESSION_TYPE}\" }, \"settings\": { \"dev.containers.copyGitConfig\": false, \"dev.containers.gitCredentialHelperConfigLocation\": \"none\" } } 2. Allowing non-root user to install VSCode’s server Here we face one of the major problems when trying to set-up this developer environment. Upon attaching to the container, VSCode will try to install its .vscode-server to the directory pointed out by $HOME. But:\nPodman apparently sets it to /root, misleading the dev containers extension We don’t want to install the server into our host’s home directory, otherwise it could conflict between dev containers A workaround here is simply to allow your non-root user to modify file in the root user’s home directory, /root. This would allow VSCode to create the /root/.vscode-server when attaching\nNote: the cleaner approach to perfectly isolate your container user from your host machine’s home directory would be to create a different user (e.g. vscode) in the container’s image, with a distinct home directory (e.g. /vscode). We could then use this user as the remoteUser. As mentioned earlier, in my setup I wanted a more seamless experience that comes with the pitfall of a shared home directory. If you follow this guide, make sure to understand when developing what commands could impact your home directory!\nTo give the write permissions to our home user, we will be using FACLs. First, login as root:\nsu - rootthen allow your user to write to the /root directory\nsetfacl -R -m u:myuser:rwx /rootreplacing myuser with your username. You can check with getfacl that the user now has the write permission on the /root directory\ngetfacl /root # file: root # owner: root # group: root user::r-x user:myuser:rwx group::r-x other::--- Note ⚠️: never do this on your host machine! In our scenario, it is fine since we can login as root in the container without password anyway, so an attacker wouldn’t even need to log as your non-root user to try to escalate privileges. But on your host machine, it’s a different story and you shouldn’t never mess with root files permissions!\n3. Attach VSCode to the running container You can now try attaching VSCode to your running container. It should install the VSCode remote server as expected, and you should be able to browse your project’s files. Also, opening a new integrated terminal should be done using your non-root user!\n4. (Optional) Fix user not in sudoers It may be that your non-root user is not in the sudoers file. Instructions will depend on the container’s distribution your using, but for Fedora user you can simply follow these steps:\nLogin as root su - root Add myuser to the wheel group usermod -a -G wheel myuser Reload group newgrp wheel Logout of the root user (usually Ctrl+D) and check that you’re now a sudoer: sudo echo \"It worked :)\" It worked :)Other tweaks As I started using this new dev environment, I ran into several small problems that don’t justify whole posts by themselves. But since others may run into the same issues, I decided to add them here just in case.\nFix slow DNF command (and others) if using custom DNS I’m a fairly privacy minded person, for example I used to work at Inpher on a privacy-preserving distributed computation framework. As many others, I tweaked my DNS settings to use a different provider, NextDNS in my case. Unexpectedly, it comes with a few side-effects, including a slow-startup for Firefox. For this issue, a workaround is to make sure to have:\n127.0.0.1 localhost fedora bazzite in /etc/hosts, so that the domain resolution for these take not time and does not hang the app’s startup.\nThis side effect is unfortunately also visible in toolbox containers, where dnf commands can take a few minutes to actually start printing anything. Again, the fix here is to make sure to have toolbox point to 127.0.0.1 in your host machine’s /etc/hosts file, so:\n127.0.0.1 localhost fedora bazzite toolbox dnf is now as fast as I could expect in toolbox containers!\nSetting GPG to sign commits and tags I recently started signing my commits and tags with GPG, increasing the security guarantees of the projects I’m working on. So naturally, I wanted to sign the commits done inside the toolbox dev containers I’m using. These changes may be very Fedora KDE/Bazzite specific!\nSet a pinentry program for GPG First, to create or use a GPG key, we need to set the pinentry-program used to prompt us for our passphrase. On the host machine, edit the ~/.gnupg/gpg-agent.conf file\nvim ~/.gnupg/gpg-agent.confand set the content to\npinentry-program /usr/bin/pinentry-qt From the Archlinux doc: The pinentry programs […], /usr/bin/pinentry-qt, […] support the DBus Secret Service API, which allows for remembering passwords via a compliant manager such as GNOME Keyring, KeePassXC or KDE Wallet.\nReload the agent with\ngpg-connect-agent reloadagent /bye OKAnd try creating a key with\ngpg --full-generate-keyor test signing a message with\necho test | gpg --clear-signIf it doesn’t work, try killing the agent then reloading it:\npkill gpg-agent..and that’s pretty much it! VSCode in the dev container will now open the pinentry-qt program to ask you for your passphrase when committing/tagging commits.\n","wordCount":"1342","inLanguage":"en","image":"https://codingarret.dev/images/posts/vscode-podman/cover.jpg","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","author":{"@type":"Person","name":"LM. Garret"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://codingarret.dev/posts/bazzite/vscode-podman/"},"publisher":{"@type":"Organization","name":"CodinGarret.dev","logo":{"@type":"ImageObject","url":"https://codingarret.dev/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://codingarret.dev/ accesskey=h title="CodinGarret.dev (Alt + H)">CodinGarret.dev</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">VSCode in Podman dev container</h1><div class=post-description>A guide on using VSCode in a Podman dev container (toolbox)</div><div class=post-meta>LM. Garret</div></header><figure class=entry-cover><img loading=eager src=https://codingarret.dev/images/posts/vscode-podman/cover.jpg alt></figure><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#using-podman-instead-of-docker aria-label="Using Podman instead of Docker">Using Podman instead of Docker</a></li><li><a href=#attaching-vscode-to-a-running-podman-container-as-a-non-root-user aria-label="Attaching VSCode to a running Podman container as a non-root user">Attaching VSCode to a running Podman container as a non-root user</a><ul><li><a href=#1-container-specific-config aria-label="1. Container-specific config">1. Container-specific config</a></li><li><a href=#2-allowing-non-root-user-to-install-vscodes-server aria-label="2. Allowing non-root user to install VSCode&rsquo;s server">2. Allowing non-root user to install VSCode&rsquo;s server</a></li><li><a href=#3-attach-vscode-to-the-running-container aria-label="3. Attach VSCode to the running container">3. Attach VSCode to the running container</a></li><li><a href=#4-optional-fix-user-not-in-sudoers aria-label="4. (Optional) Fix user not in sudoers">4. (Optional) Fix user not in sudoers</a></li></ul></li><li><a href=#other-tweaks aria-label="Other tweaks">Other tweaks</a><ul><li><a href=#fix-slow-dnf-command-and-others-if-using-custom-dns aria-label="Fix slow DNF command (and others) if using custom DNS">Fix slow DNF command (and others) if using custom DNS</a></li><li><a href=#setting-gpg-to-sign-commits-and-tags aria-label="Setting GPG to sign commits and tags">Setting GPG to sign commits and tags</a><ul><li><a href=#set-a-pinentry-program-for-gpg aria-label="Set a pinentry program for GPG">Set a pinentry program for GPG</a></li></ul></li></ul></li></ul></div></details></div><div class=post-content><p>I wrote this guide since I installed a Fedora immutable desktop spin (Bazzite) on my desktop and decided to set it up for development as well. Since toolbox and Podman are already installed out of the box, I thought it would be interesting to go all the way in and develop using VSCode attached to a Podman dev container created by toolbox.
This unfortunately does not work perfectly out of the box, and I intend to keep this guide up-to-date with all the changes I had to perform in order to get my dev environment up and running!</p><h2 id=using-podman-instead-of-docker>Using Podman instead of Docker<a hidden class=anchor aria-hidden=true href=#using-podman-instead-of-docker>#</a></h2><p>First, to make sure we can use Podman in place of Docker for dev containers, we need to adjust our VSCode settings as <a href=https://code.visualstudio.com/remote/advancedcontainers/docker-options#_podman>mentioned in the documentation</a>, to point to our Podman installation. In you VSCode settings file, add the following entries:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl>  <span class=s2>&#34;dev.containers.dockerPath&#34;</span><span class=err>:</span> <span class=s2>&#34;podman&#34;</span><span class=err>,</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;dev.containers.dockerSocketPath&#34;</span><span class=err>:</span> <span class=s2>&#34;/run/user/1000/podman/podman.sock&#34;</span>
</span></span></code></pre></div><h2 id=attaching-vscode-to-a-running-podman-container-as-a-non-root-user>Attaching VSCode to a running Podman container as a non-root user<a hidden class=anchor aria-hidden=true href=#attaching-vscode-to-a-running-podman-container-as-a-non-root-user>#</a></h2><p>There are multiple reasons why you wouldn&rsquo;t want to use the <code>root</code> user in your dev container:</p><ul><li>you have multiple shell configs for your non-root host user you would like to use in the container (e.g. getting the same experience as <code>toolbox enter my-container</code>)</li><li>you want to reuse your git config and credentials and do not want to have a distinct config per container</li><li>it feels wrong to use <code>root</code>! It&rsquo;s so often described as being a bad practice (which it is!), that even in a container we shouldn&rsquo;t have to default to using the <code>root</code> user</li></ul><p>Now if you decide that you don&rsquo;t mind, then good for you! You can skip this guide&rsquo;s section :)</p><h3 id=1-container-specific-config>1. Container-specific config<a hidden class=anchor aria-hidden=true href=#1-container-specific-config>#</a></h3><p>If not already done, create your dev container with toolbox/any other tool of your liking. We will be referring to the container&rsquo;s name as the env variable <code>$TOOLBOX_CONTAINER_NAME</code> in the rest of this guide .</p><p>We will now need to create a specific configuration file for the container, to tell VSCode to attach to it as a different user, but also pass other environment variables from the host. For this file, I largely copied content from <a href=https://github.com/containers/toolbox/issues/610#issuecomment-726057756>this helpful GitHub issue&rsquo;s comment</a>, but don&rsquo;t hesitate to adapt it to your needs.</p><blockquote><p>Note: I chose to attach as my host&rsquo;s non-root user, hence passing the <code>$USER</code> env var. This comes with the added benefit of keeping my <code>.zshrc</code> and <code>.oh-my-zsh configuration</code> working out of the box and not having to create a different user in the container image and mount these files there.
But please note that the user you will be using in the container has the same <code>$HOME</code> directory and that changes in the container <strong>could reflect in your host user&rsquo;s home</strong> ⚠️.</p></blockquote><p>So open up the file</p><div class=command><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vim <span class=s2>&#34;</span><span class=nv>$HOME</span><span class=s2>/.config/Code/User/globalStorage/ms-vscode-remote.remote-containers/nameConfigs/</span><span class=si>${</span><span class=nv>TOOLBOX_CONTAINER_NAME</span><span class=si>}</span><span class=s2>.json&#34;</span></span></span></code></pre></div></div><p>And write this content in it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span> 
</span></span><span class=line><span class=cl>  <span class=nt>&#34;remoteUser&#34;</span><span class=p>:</span> <span class=s2>&#34;${localEnv:USER}&#34;</span><span class=p>,</span>     
</span></span><span class=line><span class=cl>  <span class=nt>&#34;remoteEnv&#34;</span><span class=p>:</span> <span class=p>{</span>    
</span></span><span class=line><span class=cl>    <span class=nt>&#34;COLORTERM&#34;</span><span class=p>:</span> <span class=s2>&#34;${localEnv:COLORTERM}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;DBUS_SESSION_BUS_ADDRESS&#34;</span><span class=p>:</span> <span class=s2>&#34;${localEnv:DBUS_SESSION_BUS_ADDRESS}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;DESKTOP_SESSION&#34;</span><span class=p>:</span> <span class=s2>&#34;${localEnv:DESKTOP_SESSION}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;DISPLAY&#34;</span><span class=p>:</span> <span class=s2>&#34;${localEnv:DISPLAY}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;LANG&#34;</span><span class=p>:</span> <span class=s2>&#34;${localEnv:LANG}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;SHELL&#34;</span><span class=p>:</span> <span class=s2>&#34;${localEnv:SHELL}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;SSH_AUTH_SOCK&#34;</span><span class=p>:</span> <span class=s2>&#34;${localEnv:SSH_AUTH_SOCK}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;TERM&#34;</span><span class=p>:</span> <span class=s2>&#34;${localEnv:TERM}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;VTE_VERSION&#34;</span><span class=p>:</span> <span class=s2>&#34;${localEnv:VTE_VERSION}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;XDG_CURRENT_DESKTOP&#34;</span><span class=p>:</span> <span class=s2>&#34;${localEnv:XDG_CURRENT_DESKTOP}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;XDG_DATA_DIRS&#34;</span><span class=p>:</span> <span class=s2>&#34;${localEnv:XDG_DATA_DIRS}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;XDG_MENU_PREFIX&#34;</span><span class=p>:</span> <span class=s2>&#34;${localEnv:XDG_MENU_PREFIX}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;XDG_RUNTIME_DIR&#34;</span><span class=p>:</span> <span class=s2>&#34;${localEnv:XDG_RUNTIME_DIR}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;XDG_SESSION_DESKTOP&#34;</span><span class=p>:</span> <span class=s2>&#34;${localEnv:XDG_SESSION_DESKTOP}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;XDG_SESSION_TYPE&#34;</span><span class=p>:</span> <span class=s2>&#34;${localEnv:XDG_SESSION_TYPE}&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;settings&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;dev.containers.copyGitConfig&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;dev.containers.gitCredentialHelperConfigLocation&#34;</span><span class=p>:</span> <span class=s2>&#34;none&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=2-allowing-non-root-user-to-install-vscodes-server>2. Allowing non-root user to install VSCode&rsquo;s server<a hidden class=anchor aria-hidden=true href=#2-allowing-non-root-user-to-install-vscodes-server>#</a></h3><p>Here we face one of the major problems when trying to set-up this developer environment. Upon attaching to the container, VSCode will try to install its <code>.vscode-server</code> to the directory pointed out by <code>$HOME</code>. But:</p><ul><li>Podman <a href=https://github.com/microsoft/vscode-remote-release/issues/7657#issuecomment-1441350625>apparently sets it to <code>/root</code></a>, misleading the dev containers extension</li><li>We don&rsquo;t want to install the server into our host&rsquo;s home directory, otherwise it could conflict between dev containers</li></ul><p>A workaround here is simply to allow your non-root user to modify file in the <code>root</code> user&rsquo;s home directory, <code>/root</code>. This would allow VSCode to create the <code>/root/.vscode-server</code> when attaching</p><blockquote><p>Note: the cleaner approach to perfectly isolate your container user from your host machine&rsquo;s home directory would be to create a different user (e.g. <code>vscode</code>) in the container&rsquo;s image, with a distinct home directory (e.g. <code>/vscode</code>). We could then use this user as the <code>remoteUser</code>. As mentioned earlier, in my setup I wanted a more seamless experience that comes with the pitfall of a shared home directory. If you follow this guide, make sure to understand when developing what commands could impact your home directory!</p></blockquote><p>To give the write permissions to our home user, we will be using FACLs. First, login as root:</p><div class=command><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>su - root</span></span></code></pre></div></div><p>then allow your user to write to the <code>/root</code> directory</p><div class=command><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>setfacl -R -m u:myuser:rwx /root</span></span></code></pre></div></div><p>replacing <code>myuser</code> with your username. You can check with <code>getfacl</code> that the user now has the write permission on the <code>/root</code> directory</p><div class=command><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>getfacl /root
</span></span><span class=line><span class=cl><span class=c1># file: root</span>
</span></span><span class=line><span class=cl><span class=c1># owner: root</span>
</span></span><span class=line><span class=cl><span class=c1># group: root</span>
</span></span><span class=line><span class=cl>user::r-x
</span></span><span class=line><span class=cl>user:myuser:rwx
</span></span><span class=line><span class=cl>group::r-x
</span></span><span class=line><span class=cl>other::---</span></span></code></pre></div></div><blockquote><p>Note ⚠️: <strong>never do this on your host machine</strong>! In our scenario, it is fine since we can login as root in the container without password anyway, so an attacker wouldn&rsquo;t even need to log as your non-root user to try to escalate privileges. But on your host machine, it&rsquo;s a different story and you shouldn&rsquo;t never mess with root files permissions!</p></blockquote><h3 id=3-attach-vscode-to-the-running-container>3. Attach VSCode to the running container<a hidden class=anchor aria-hidden=true href=#3-attach-vscode-to-the-running-container>#</a></h3><p>You can now try attaching VSCode to your running container. It should install the VSCode remote server as expected, and you should be able to browse your project&rsquo;s files. Also, opening a new integrated terminal should be done using your non-root user!</p><h3 id=4-optional-fix-user-not-in-sudoers>4. (Optional) Fix user not in sudoers<a hidden class=anchor aria-hidden=true href=#4-optional-fix-user-not-in-sudoers>#</a></h3><p>It may be that your non-root user is not in the sudoers file. Instructions will depend on the container&rsquo;s distribution your using, but for Fedora user you can simply follow these steps:</p><ol><li>Login as root</li></ol><div class=command><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>su - root</span></span></code></pre></div></div><ol start=2><li>Add <code>myuser</code> to the wheel group</li></ol><div class=command><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>usermod -a -G wheel myuser </span></span></code></pre></div></div><ol start=3><li>Reload group</li></ol><div class=command><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>newgrp wheel</span></span></code></pre></div></div><ol start=4><li>Logout of the <code>root</code> user (usually Ctrl+D) and check that you&rsquo;re now a sudoer:</li></ol><div class=command><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo <span class=nb>echo</span> <span class=s2>&#34;It worked :)&#34;</span>
</span></span><span class=line><span class=cl>It worked :<span class=o>)</span></span></span></code></pre></div></div><h2 id=other-tweaks>Other tweaks<a hidden class=anchor aria-hidden=true href=#other-tweaks>#</a></h2><p>As I started using this new dev environment, I ran into several small problems that don&rsquo;t justify whole posts by themselves. But since others may run into the same issues, I decided to add them here just in case.</p><h3 id=fix-slow-dnf-command-and-others-if-using-custom-dns>Fix slow DNF command (and others) if using custom DNS<a hidden class=anchor aria-hidden=true href=#fix-slow-dnf-command-and-others-if-using-custom-dns>#</a></h3><p>I&rsquo;m a fairly privacy minded person, for example I used to work at Inpher on a privacy-preserving distributed computation framework. As many others, I tweaked my DNS settings to use a different provider, <a href=https://nextdns.io/>NextDNS</a> in my case. Unexpectedly, it comes with a few side-effects, including <a href=https://discussion.fedoraproject.org/t/firefox-takes-several-minutes-to-open/114320>a slow-startup for Firefox</a>. For this issue,
a workaround is to make sure to have:</p><pre tabindex=0><code class=language-conf data-lang=conf>127.0.0.1   localhost fedora bazzite
</code></pre><p>in <code>/etc/hosts</code>, so that the domain resolution for these take not time and does not hang the app&rsquo;s startup.</p><p>This side effect is unfortunately also visible in <code>toolbox</code> containers, where <code>dnf</code> commands can take a few minutes to actually start printing anything. Again, the fix here is to make sure to have <code>toolbox</code> point to <code>127.0.0.1</code> in your <strong>host machine</strong>&rsquo;s <code>/etc/hosts</code> file, so:</p><pre tabindex=0><code class=language-conf data-lang=conf>127.0.0.1   localhost fedora bazzite toolbox
</code></pre><p><code>dnf</code> is now as fast as I could expect in <code>toolbox</code> containers!</p><h3 id=setting-gpg-to-sign-commits-and-tags>Setting GPG to sign commits and tags<a hidden class=anchor aria-hidden=true href=#setting-gpg-to-sign-commits-and-tags>#</a></h3><p>I recently started signing my commits and tags with GPG, increasing the security guarantees of the projects I&rsquo;m working on. So naturally, I wanted to sign the commits done inside the <code>toolbox</code> dev containers I&rsquo;m using. These changes may be very Fedora KDE/Bazzite specific!</p><h4 id=set-a-pinentry-program-for-gpg>Set a pinentry program for GPG<a hidden class=anchor aria-hidden=true href=#set-a-pinentry-program-for-gpg>#</a></h4><p>First, to create or use a GPG key, we need to set the <code>pinentry-program</code> used to prompt us for our passphrase. On the host machine, edit the <code>~/.gnupg/gpg-agent.conf</code> file</p><div class=command><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vim ~/.gnupg/gpg-agent.conf</span></span></code></pre></div></div><p>and set the content to</p><pre tabindex=0><code>pinentry-program /usr/bin/pinentry-qt
</code></pre><blockquote><p>From the Archlinux doc: The pinentry programs [&mldr;], /usr/bin/pinentry-qt, [&mldr;] support the DBus Secret Service API, which allows for remembering passwords via a compliant manager such as GNOME Keyring, KeePassXC or KDE Wallet.</p></blockquote><p>Reload the agent with</p><div class=command><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gpg-connect-agent reloadagent /bye
</span></span><span class=line><span class=cl>OK</span></span></code></pre></div></div><p>And try creating a key with</p><div class=command><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gpg --full-generate-key</span></span></code></pre></div></div><p>or test signing a message with</p><div class=command><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>echo</span> <span class=nb>test</span> <span class=p>|</span> gpg --clear-sign</span></span></code></pre></div></div><p>If it doesn&rsquo;t work, try killing the agent then reloading it:</p><div class=command><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pkill gpg-agent</span></span></code></pre></div></div><p>..and that&rsquo;s pretty much it! VSCode in the dev container will now open the <code>pinentry-qt</code> program to ask you for your passphrase when committing/tagging commits.</p></div><footer class=post-footer><ul class=post-tags></ul></footer><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){this.page.url="https://codingarret.dev/posts/bazzite/vscode-podman/",this.page.identifier="https://codingarret.dev/posts/bazzite/vscode-podman/",this.page.title="VSCode in Podman dev container"};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//lmgarret.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></main><footer class=footer><span>&copy; 2024 <a href=https://codingarret.dev/>CodinGarret.dev</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll(".command > .highlight > pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.firstChild.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script defer src=https://umami.lmgarret.fr/script.js data-website-id=4bb24348-dc61-47eb-98b1-ca1589ec1078></script></body></html>